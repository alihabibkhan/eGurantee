<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'head.html' %}
    <title>{{ 'Edit Branch' if result.branch_details else 'Add Branch' }}</title>
    <style>
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .form-row .form-group {
            flex: 1;
            min-width: 0;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}
    {% import 'breadcrumbs.html' as brd %}
    {{ brd.render_Breadcrumbs([{"url": "manage_branches", "label": "Manage Branches"}, {"url": "", "label": 'Edit Branch' if result.branch_details else 'Add Branch'}]) }}

    <div class="container mt-4">
        {% include 'message_box.html' %}

        <div class="card">
            <div class="card-header">
                <h2>{{ 'Edit Branch' if result.branch_details else 'Add Branch' }}</h2>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="form-group mb-3">
                        <div class="form-group">
                            <label for="bank_id">Bank</label>
                            <select name="bank_id" id="bank_id" class="form-control form-select" required>
                                <option value="">[[select...]]</option>
                                {% for bank in result.bank_details %}
                                    <option value="{{ bank.bank_id }}" {% if result.branch_details and result.branch_details.bank_id == bank.bank_id %}selected{% endif %}>
                                        {{ bank.bank_code }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="branch_name">Branch Name</label>
                            <input type="text" name="branch_name" class="form-control" value="{{ result.branch_details.branch_name if result.branch_details else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label for="branch_code">Branch Code</label>
                            <input type="text" name="branch_code" class="form-control" value="{{ result.branch_details.branch_code if result.branch_details else '' }}" required>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="role">Role</label>
                            <select name="role" id="role" class="form-select form-control" required>
                                <option value="">[[select...]]</option>
                                {% set seen_roles = [] %}
                                {% for item in result.get_all_branches_info if item['role'] not in seen_roles %}
                                <option value="{{ item['role'] }}" {% if result.branch_details and result.branch_details.role == item['role'] %}selected{% endif %}>{{ item['role'] }}</option>
                                {{ seen_roles.append(item['role']) }}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="role">Branch</label>
                            <input type="text" name="branch" class="form-control" value="{{ result.branch_details.branch if result.branch_details else '' }}" required>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="area">Area</label>
                            <input type="text" name="area" class="form-control" value="{{ result.branch_details.area if result.branch_details else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label for="area">Area Name</label>
                            <input type="text" name="area_name" class="form-control" value="{{ result.branch_details.area_name if result.branch_details else '' }}" required>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="role">Branch Manager Name</label>
                            <input type="text" name="branch_manager" class="form-control" value="{{ result.branch_details.branch_manager if result.branch_details else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" name="email" class="form-control" value="{{ result.branch_details.email if result.branch_details else '' }}" required>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="bank_distribution">Bank Distribution</label>
                            <select name="bank_distribution" class="form-control form-select">
                                <option value="">[[select...]]</option>
                                <option value="sindh_baluchistan" {% if result.branch_details and result.branch_details.bank_distribution == "sindh_baluchistan" %} selected {% endif %}>Sindh & Baluchistan</option>
                                <option value="north" {% if result.branch_details and result.branch_details.bank_distribution == "north" %} selected {% endif %}>North</option>
                                <option value="central_punjab" {% if result.branch_details and result.branch_details.bank_distribution == "central_punjab" %} selected {% endif %}>Central Punjab</option>
                                <option value="south_punjab" {% if result.branch_details and result.branch_details.bank_distribution == "south_punjab" %} selected {% endif %}>South Punjab</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="kft_distribution">KFT Distribution</label>
                            <select name="kft_distribution" class="form-control">
                                <option value="">[[select...]]</option>
                                <option value="southern_central" {% if result.branch_details and result.branch_details.kft_distribution == "southern_central" %} selected {% endif %}>Southern & Central</option>
                                <option value="upper_lower_chitral" {% if result.branch_details and result.branch_details.kft_distribution == "upper_lower_chitral" %} selected {% endif %}>Upper & Lower Chitral</option>
                                <option value="hunza_gupis_yaseen" {% if result.branch_details and result.branch_details.kft_distribution == "hunza_gupis_yaseen" %} selected {% endif %}>Hunza & Gupis Yaseen</option>
                                <option value="gilgit_ishkoman_puniyal" {% if result.branch_details and result.branch_details.kft_distribution == "gilgit_ishkoman_puniyal" %} selected {% endif %}>Gilgit & Ishkoman Puniyal RC</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <div class="form-group">
                            <label for="national_council_distribution">National Council Distribution</label>
                            <select name="national_council_distribution" class="form-control form-select">
                                <option value="">[[select...]]</option>
                                <option value="southern_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "southern_rc" %} selected {% endif %}>Southern RC</option>
                                <option value="central_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "central_rc" %} selected {% endif %}>Central RC</option>
                                <option value="upper_chitral_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "upper_chitral_rc" %} selected {% endif %}>Upper Chitral RC</option>
                                <option value="lower_chitral_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "lower_chitral_rc" %} selected {% endif %}>Lower Chitral RC</option>
                                <option value="hunza_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "hunza_rc" %} selected {% endif %}>Hunza RC</option>
                                <option value="gilgit_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "gilgit_rc" %} selected {% endif %}>Gilgit RC</option>
                                <option value="ishkoman_puniyal_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "ishkoman_puniyal_rc" %} selected {% endif %}>Ishkoman Puniyal RC</option>
                                <option value="gupis_yasin_rc" {% if result.branch_details and result.branch_details.national_council_distribution == "gupis_yasin_rc" %} selected {% endif %}>Gupis Yasin RC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="live_branch">Branch Live</label>
                            <select name="live_branch" id="live_branch" class="form-control form-select" required>
                                <option value="1" {% if result.branch_details and result.branch_details.live_branch|string == '1' %}selected{% endif %}>Active</option>
                                <option value="2" {% if result.branch_details and result.branch_details.live_branch|string == '2' %}selected{% endif %}>In-Active</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">{{ 'Update Branch' if result.branch_details else 'Add Branch' }}</button>
                </form>
            </div>
        </div>
    </div>
</body>
</html>